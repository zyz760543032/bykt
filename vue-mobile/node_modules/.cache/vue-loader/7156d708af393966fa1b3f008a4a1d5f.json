{"remainingRequest":"D:\\vscode\\glkt\\vue-mobile\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\vscode\\glkt\\vue-mobile\\src\\views\\trade.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\vscode\\glkt\\vue-mobile\\src\\views\\trade.vue","mtime":1646622660229},{"path":"D:\\vscode\\glkt\\vue-mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\vscode\\glkt\\vue-mobile\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\vscode\\glkt\\vue-mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\vscode\\glkt\\vue-mobile\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBjb3Vyc2VBcGkgZnJvbSAnQC9hcGkvY291cnNlJwppbXBvcnQgb3JkZXJBcGkgZnJvbSAnQC9hcGkvb3JkZXInCmltcG9ydCBjb3Vwb25BcGkgZnJvbSAnQC9hcGkvY291cG9uJwpleHBvcnQgZGVmYXVsdCB7CiAgICBkYXRhKCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGxvYWRpbmc6IGZhbHNlLAoKICAgICAgICAgICAgY291cnNlSWQ6IG51bGwsCiAgICAgICAgICAgIGNvdXJzZVZvOiB7fSwKICAgICAgICAgICAgdGVhY2hlcjoge30sCgogICAgICAgICAgICBvcmRlcklkOiBudWxsLAoKICAgICAgICAgICAgc2hvd0xpc3Q6ZmFsc2UsCiAgICAgICAgICAgIGNob3NlbkNvdXBvbjogLTEsCiAgICAgICAgICAgIGNvdXBvbnM6IFtdLAogICAgICAgICAgICBkaXNhYmxlZENvdXBvbnM6IFtdLAogICAgICAgICAgICBjb3Vwb25JZDogbnVsbCwKICAgICAgICAgICAgY291cG9uVXNlSWQ6IG51bGwsCgogICAgICAgICAgICBjb3Vwb25SZWR1Y2U6IDAsCiAgICAgICAgICAgIGZpbmFsQW1vdW50OiAwCiAgICAgICAgfTsKICAgIH0sCgogICAgY3JlYXRlZCgpIHsKICAgICAgICB0aGlzLmNvdXJzZUlkID0gdGhpcy4kcm91dGUucGFyYW1zLmNvdXJzZUlkOwogICAgICAgIHRoaXMuZmV0Y2hEYXRhKCkKICAgICAgICB0aGlzLmdldENvdXBvbkluZm8oKTsKICAgIH0sCgogICAgbWV0aG9kczogewogICAgICAgIG9uQ2hhbmdlKGluZGV4KSB7CiAgICAgICAgICAgIGRlYnVnZ2VyCiAgICAgICAgICAgIHRoaXMuc2hvd0xpc3QgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5jaG9zZW5Db3Vwb24gPSBpbmRleDsKCiAgICAgICAgICAgIHRoaXMuY291cG9uSWQgPSB0aGlzLmNvdXBvbnNbaW5kZXhdLmlkOwogICAgICAgICAgICB0aGlzLmNvdXBvblVzZUlkID0gdGhpcy5jb3Vwb25zW2luZGV4XS5jb3Vwb25Vc2VJZDsKICAgICAgICAgICAgdGhpcy5jb3Vwb25SZWR1Y2UgPSB0aGlzLmNvdXBvbnNbaW5kZXhdLnZhbHVlOwogICAgICAgICAgICB0aGlzLmZpbmFsQW1vdW50ID0gcGFyc2VGbG9hdCh0aGlzLmZpbmFsQW1vdW50KSAtIHBhcnNlRmxvYXQodGhpcy5jb3Vwb25SZWR1Y2UpCiAgICAgICAgfSwKCiAgICAgICAgZmV0Y2hEYXRhKCkgewogICAgICAgICAgICBkZWJ1Z2dlcgogICAgICAgICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlOwogICAgICAgICAgICBjb3Vyc2VBcGkuZ2V0SW5mbyh0aGlzLmNvdXJzZUlkKS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgICAgdGhpcy5jb3Vyc2VWbyA9IHJlc3BvbnNlLmRhdGEuY291cnNlVm87CiAgICAgICAgICAgICAgICB0aGlzLnRlYWNoZXIgPSByZXNwb25zZS5kYXRhLnRlYWNoZXI7CiAgICAgICAgICAgICAgICAvL+i9rOaNouS4uuWIhgogICAgICAgICAgICAgICAgdGhpcy5maW5hbEFtb3VudCA9IHBhcnNlRmxvYXQodGhpcy5jb3Vyc2VWby5wcmljZSkqMTAwOwoKICAgICAgICAgICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAoKCiAgICAgICAgZ2V0Q291cG9uSW5mbygpIHsKICAgICAgICAgICAgLy9kZWJ1Z2dlcgogICAgICAgICAgICBjb3Vwb25BcGkuZmluZENvdXBvbkluZm8oKS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgICAgdGhpcy5jb3Vwb25zID0gcmVzcG9uc2UuZGF0YS5hYmxlZENvdXBvbnNMaXN0OwogICAgICAgICAgICAgICAgdGhpcy5kaXNhYmxlZENvdXBvbnMgPSByZXNwb25zZS5kYXRhLmRpc2FibGVkQ291cG9uc0xpc3Q7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCgogICAgICAgIHN1cmVPcmRlcigpIHsKICAgICAgICAgICAgLy9kZWJ1Z2dlcgogICAgICAgICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlOwogICAgICAgICAgICBsZXQgb3JkZXJGb3JtVm8gPSB7CiAgICAgICAgICAgICAgICAnY291cnNlSWQnOiB0aGlzLmNvdXJzZUlkLAogICAgICAgICAgICAgICAgJ2NvdXBvbklkJzogdGhpcy5jb3Vwb25JZCwKICAgICAgICAgICAgICAgICdjb3Vwb25Vc2VJZCc6IHRoaXMuY291cG9uVXNlSWQKICAgICAgICAgICAgfQogICAgICAgICAgICBvcmRlckFwaS5zdWJtaXRPcmRlcihvcmRlckZvcm1WbykudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZS5kYXRhKQogICAgICAgICAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goeyBwYXRoOiAnL3BheS8nK3Jlc3BvbnNlLmRhdGEgfSkKICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICB9Cn07Cg=="},{"version":3,"sources":["trade.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoDA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"trade.vue","sourceRoot":"src/views","sourcesContent":["<template>\n\n    <div>\n        <van-image width=\"100%\" height=\"200\" :src=\"courseVo.cover\"/>\n\n        <h1 class=\"van-ellipsis course_title\">{{ courseVo.title }}</h1>\n\n        <div class=\"course_teacher_price_box\">\n            <div class=\"course_teacher_price\">\n                <div class=\"course_price\">价格：</div>\n                <div class=\"course_price_number\">￥{{ courseVo.price }}</div>\n            </div>\n        </div>\n        <div class=\"course_teacher_price_box\">\n            <div class=\"course_teacher_box\">\n                <div class=\"course_teacher\">主讲： {{ teacher.name }}</div>\n                <van-image :src=\"teacher.avatar\" round width=\"50px\" height=\"50px\" />\n            </div>\n        </div>\n\n        <van-loading vertical=\"true\" v-show=\"loading\">加载中...</van-loading>\n\n        <div style=\"position:fixed;left:0px;bottom:50px;width:100%;height:50px;z-index:999;\">\n            <!-- 优惠券单元格 -->\n            <van-coupon-cell\n                    :coupons=\"coupons\"\n                    :chosen-coupon=\"chosenCoupon\"\n                    @click=\"showList = true\"\n            />\n            <!-- 优惠券列表 -->\n            <van-popup\n                    v-model=\"showList\"\n                    round\n                    position=\"bottom\"\n                    style=\"height: 90%; padding-top: 4px;\"\n            >\n                <van-coupon-list\n                        :coupons=\"coupons\"\n                        :chosen-coupon=\"chosenCoupon\"\n                        :disabled-coupons=\"disabledCoupons\"\n                        @change=\"onChange\"\n                />\n            </van-popup>\n        </div>\n\n        <van-goods-action>\n            <van-submit-bar :price=\"finalAmount\" button-text=\"确认下单\" @submit=\"sureOrder\"/>\n        </van-goods-action>\n    </div>\n</template>\n\n<script>\nimport courseApi from '@/api/course'\nimport orderApi from '@/api/order'\nimport couponApi from '@/api/coupon'\nexport default {\n    data() {\n        return {\n            loading: false,\n\n            courseId: null,\n            courseVo: {},\n            teacher: {},\n\n            orderId: null,\n\n            showList:false,\n            chosenCoupon: -1,\n            coupons: [],\n            disabledCoupons: [],\n            couponId: null,\n            couponUseId: null,\n\n            couponReduce: 0,\n            finalAmount: 0\n        };\n    },\n\n    created() {\n        this.courseId = this.$route.params.courseId;\n        this.fetchData()\n        this.getCouponInfo();\n    },\n\n    methods: {\n        onChange(index) {\n            debugger\n            this.showList = false;\n            this.chosenCoupon = index;\n\n            this.couponId = this.coupons[index].id;\n            this.couponUseId = this.coupons[index].couponUseId;\n            this.couponReduce = this.coupons[index].value;\n            this.finalAmount = parseFloat(this.finalAmount) - parseFloat(this.couponReduce)\n        },\n\n        fetchData() {\n            debugger\n            this.loading = true;\n            courseApi.getInfo(this.courseId).then(response => {\n                // console.log(response.data);\n                this.courseVo = response.data.courseVo;\n                this.teacher = response.data.teacher;\n                //转换为分\n                this.finalAmount = parseFloat(this.courseVo.price)*100;\n\n                this.loading = false;\n            });\n        },\n\n\n        getCouponInfo() {\n            //debugger\n            couponApi.findCouponInfo().then(response => {\n                // console.log(response.data);\n                this.coupons = response.data.abledCouponsList;\n                this.disabledCoupons = response.data.disabledCouponsList;\n            });\n        },\n\n        sureOrder() {\n            //debugger\n            this.loading = true;\n            let orderFormVo = {\n                'courseId': this.courseId,\n                'couponId': this.couponId,\n                'couponUseId': this.couponUseId\n            }\n            orderApi.submitOrder(orderFormVo).then(response => {\n                console.log(response.data)\n                this.$router.push({ path: '/pay/'+response.data })\n            })\n        }\n    }\n};\n</script>\n\n<style lang=\"scss\" scoped>\n    .gap {\n        height: 10px;\n    }\n\n    ::v-deep.van-image {\n        display: block;\n    }\n\n    .course_count {\n        background-color: #82848a;\n        color: white;\n        padding: 5px;\n        text-align: center;\n        border-right: 1px solid #939393;\n\n        h1 {\n            font-size: 14px;\n            margin: 0;\n        }\n\n        p {\n            margin: 0;\n            font-size: 16px;\n        }\n    }\n\n    .course_title {\n        font-size: 20px;\n        margin: 10px;\n    }\n\n    .course_teacher_price_box {\n        margin: 10px;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n\n        .course_teacher_price {\n            display: flex;\n            font-size: 14px;\n            align-items: center;\n\n            .course_price_number {\n                color: red;\n                font-size: 18px;\n                font-weight: bold;\n            }\n        }\n\n        .course_teacher_box {\n            display: flex;\n            justify-content: center;\n            align-items: center;\n\n            .course_teacher {\n                margin-right: 20px;\n            }\n        }\n    }\n\n    .course_contents {\n        margin: 10px;\n\n        .course_title_font {\n            color: #68cb9b;\n            font-weight: bold;\n        }\n\n        .course_content {\n            margin-bottom: 20px;\n        }\n    }\n\n    .course_chapter_list {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n\n        h2 {\n            font-size: 14px;\n        }\n\n        p {\n            margin: 0;\n        }\n    }\n</style>\n"]}]}